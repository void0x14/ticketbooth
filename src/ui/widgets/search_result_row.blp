// Copyright (C) 2022 - 2023 Alessandro Iepure
// Maintenance & Enhancements Copyright (C) 2026 void0x14
//
// SPDX-License-Identifier: GPL-3.0-or-later

using Gtk 4.0;
using Adw 1;

template $SearchResultRow: Box {

  map => $_on_map();
  css-name: "search_result_row";

  hexpand: true;
  vexpand: true;
  
  // Previous `activatable` property removed as it is not available in GtkBox
  
  // Content moved directly into this Box or kept as nested
  // Since the template has `child: Box`, and GtkBox does not have a `child` property (it has children),
  // we need to be careful. BLP syntax for Box children is just listing them?
  // Or if it inherits Box, it IS a Box.
  // The original had `child: Box`. ListBoxRow has a `child` property. Box does NOT.
  // Box uses append/prepend.
  
  // Let's look at the structure.
  // The structure was: ListBoxRow -> Box -> ...
  // Now it will be: Box -> inner Box -> ...
  // Or just: Box -> [Overlay, Box]
  
  // Wait, `template $SearchResultRow: Box` means SearchResultRow INSTANCE IS A BOX.
  // So we just add children to it.
  
  valign: start;
    // vexpand: true; // REMOVED (Duplicate)
    spacing: 12;
    orientation: horizontal;
    margin-top: 6;
    margin-bottom: 6;

    Overlay {

      [overlay]
      Adw.Spinner _poster_spinner {
        height-request: 32;
        width-request: 32;
        valign: center;
      }

      Picture _poster_picture {
        width-request: 100;
        height-request: 150;

        styles ["poster"]
      }
    }

    Box {
      orientation: vertical;

      Label _title_lbl {
        halign: start;
        ellipsize: end;
        hexpand: true;
        label: bind template.title;
        styles ["heading"]
      }

      Box _caption_box {
        orientation: horizontal;
        spacing: 12;
        halign: start;

        Label _year_lbl {
          hexpand: true;
          halign: start;
          label: bind template.year;
          styles ["caption", "chip"]
          visible: bind template.year-visible;
        }

        Label _media_type_lbl {
          label: bind template.media_type;
          styles ["caption", "chip"]
        }
      }

      Label _description {
        hexpand: true;
        margin-top: 6;
        halign: start;
        wrap: true;
        wrap-mode: word;
        label: bind template.description;
        lines: 4;
        ellipsize: end;
      }

      Box {
        orientation: horizontal;
        spacing: 12;
        valign: end;

        Button {
          child: Adw.ButtonContent _add_btn {
            label: _("Add to watchlist");
            icon-name: "plus";
          };
          halign: start;
          vexpand: true;
          valign: end;

          clicked => $_on_add_btn_clicked();

          styles ["suggested-action"]
        }

        Adw.Spinner _add_spinner {
          height-request: 16;
          visible: false;
        }
      }
    }
}
